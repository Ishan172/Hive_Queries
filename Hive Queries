Hive

2b) find top 5 locations in the US who have got certified visa for each year.


select worksite,year,count(worksite) as location from h1b_applications where case_status='CERTIFIED' or case_status='CERTIFIED WITHDRAWN' and year in ('2011','2012','2013','2014' ,'2015','2016') group by year,worksite order by location desc;

select worksite,year,count(worksite) as location from h1b_applications where case_status='CERTIFIED' or case_status='CERTIFIED WITHDRAWN' group by year,worksite order by location desc limit 6;

3)Which industry has the most number of Data Scientist positions?


select soc_name, count(job_title) as Max,year from h1b_applications where job_title = 'DATA SCIENTIST' group by soc_name,year order by Max desc;


5) Find the most popular top 10 job positions for H1B visa applications for each year?

select year,job_title, count(job_title) as max from h1b_applications group by job_title,year order by max desc limit 10;

--select a.year from (select year,job_title, count(job_title) as max from h1b_applications group by job_title,year order by max desc limit 10)a group by a.year;

8) Find the average Prevailing Wage for each Job for each Year (take part time and full time separate). Arrange the output in descending order.

select b.job_title,round(b.Y_avg,2) ,round(a.N_avg,2) ,a.year from (select year,avg(prevailing_wage)as N_avg,job_title from h1b_applications where full_time_position="N"  group by job_title,year) a join (select avg(prevailing_wage)as Y_avg,job_title from h1b_applications where full_time_position="Y" group by job_title,year order by Y_avg desc) b on a.job_title=b.job_title;


9) Which are  employers along with the number of petitions who have the success rate more than 70%  in petitions and total petitions filed more than 1000?


select a.employer_name, (a.Cert_most + b.Cert_most1)/c.total from
(select employer_name, count(employer_name)as Cert_most from h1b_applications where case_status="CERTIFIED"group by employer_name) a,(select employer_name, count(employer_name)as Cert_most1 from h1b_applications where case_status="CERTIFIED-WITHDRAWN"  group by employer_name)b ,(select count(employer_name)as total from h1b_applications) c; 

select b.employer_name,round((certified_petitions*100/total_petitions),2)as success_rate from (select count(*) as total_petitions from h1b_applications) a,(select employer_name,count(*) as certified_petitions from h1b_applications where case_status="CERTIFIED" or case_status="CERTIFIED-WITHDRAWN" group by employer_name) b order by success_rate desc ;


select * from (select b.employer_name,round((certified_petitions*100/total_petitions),2)as success_rate from (select count(*) as total_petitions from h1b_applications) a,(select employer_name,count(*) as certified_petitions from h1b_applications where case_status="CERTIFIED" or case_status="CERTIFIED-WITHDRAWN" group by employer_name) b order by success_rate desc) c where c.success_rate > 70 ;

